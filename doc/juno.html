<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.2.5 (459226)"/><meta name="author" content="182bzhrx274"/><meta name="created" content="2019-12-14 15:40:56 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-02-28 05:45:03 +0000"/><meta name="content-class" content="yinxiang.markdown"/><title>无标题</title></head><body><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h1 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 41px; border-bottom: 3px double #999; color: #000; margin-top: 14px;">Juno文档说明</h1>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">一. SkipList(跳跃表)</h2>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">SkipList是一种随机化的数据结构，基于并联的链表，实现简单，插入、删除、查找的复杂度均为O(logN),性能与红黑树相当，且实现较为简单，因此在很多著名项目都用跳表来代替红黑树，例如LevelDB、Reddis的底层存储结构就是用的SkipList。</li>
<li style="line-height: 160%; box-sizing: content-box;">SkipList的特征:</li>
</ol>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">一个跳表应该由几个层（level）组成，Juno中默认使用12层。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">跳表的第0层包含所有的元素，节点值是有序的，juno节点保存的是ELement元素，根据Element中的id(campaignId)来排序。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">每一层都是一个有序的链表，层数越高，节点数越少。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">如果元素x出现在第i层，则所有比i小的层都包含x。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">每个节点包含key及其对应的value和一个指向该节点第n层的下个节点的指针数组表示第level层的x的下一个节点。</li>
</ul>
<ol start="3" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">SkipList的查询过程:<br/>
假设SKipList中包含13、22、75、80、99这几个元素，查找元素80的过程如图所示<br/>
<img src="https://segmentfault.com/img/bVbpAok?w=869&amp;h=453" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></li>
<li style="line-height: 160%; box-sizing: content-box;">SkipList的插入过程:<br/>
<img src="https://segmentfault.com/img/bVbpAoj?w=814&amp;h=398" style="line-height: 160%; margin: 4px 0 10px; box-sizing: border-box; vertical-align: top; max-width: 100%;"/></li>
</ol>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">二. juno的document信息</h2>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Field <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
	Name      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// campaign的字段名</span>
	IndexType IndexType  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 索引类型，1.倒排,2.正排,3.两个都建</span>
	Value     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{} <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// campaign字段名对应的值</span>
        ValueType FieldType <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// value值得类型(类sql语法中使用)</span>
}

<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> DocInfo <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> { <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// juno文档结构</span>
	Id     DocId   <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// campaignId</span>
	Fields []*Field <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 对应一条查询中的所有Field信息</span>
}

<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// eg: </span>
  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> CampaignInfo <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
	CampaignId     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int64</span>    <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">`bson:"campaignId,omitempty" json:"campaignId,omitempty"`</span>
	AdvertiserId   *<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int32</span>   <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">`bson:"advertiserId,omitempty" json:"advertiserId,omitempty"`</span>
	CampaignType   *<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int32</span>   <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">`bson:"campaignType,omitempty" json:"campaignType,omitempty"`</span>
}
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">var</span> info *CampaignInfo
    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">var</span> doc1 = &amp;document.DocInfo{
        Id: campaign.CampaignId,
        Fields: []*document.Field{
        {
           Name:      <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"AdvertiserId"</span>,
			IndexType: storageIndexType,
			Value:    *info.AdvertiserId,
			ValueType: document.IntFieldType,
        },
        {
        	Name:      <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"CampaignType"</span>,
			IndexType: invertIndexType,
			Value:     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int64</span>(*info.CampaignType),
			ValueType: document.IntFieldType,
        },
        ...
    }
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在建立索引的时候，首先将campaign的结构信息转换为docInfo信息，在建立索引,倒排可以使用int64,string,[]int64,[]string,底层都会转换成string实现，正排支持任意类型的字段。</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">三. Juno的组成</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">主要包含两个部分，索引（index）和查询（query）</p>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">索引（index）: 由倒排和正排两个部分组成</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 索引接口信息</span>
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Index <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span> {
          <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 新增文档</span>
          Add(docInfo *document.DocInfo) error
          <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 删除文档</span>
          Del(docInfo *document.DocInfo)
          <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 获取上面FIeld中ValueType的信息(类sql中使用)</span>
          GetDataType(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>) document.FieldType
          <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 根据id获取索引字段</span>
          GetValueById(id document.DocId) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>[<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>][]<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>
          Dump(filename <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>) error
          Load(filename <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>) error
          DebugInfo() *debug.Debug
      }
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// eg: index.Add(info)</span>
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 倒排结构信息</span>
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> InvertedIndexer <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> { 
          data   sync.Map
          <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 序列化的时候用来保存query传进来的字段名和condition值</span>
          field  []<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>    
          value  []<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>
          aDebug *debug.Debug
      }
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 正排结构信息</span>
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> StorageIndexer <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> { 
          data      sync.Map
          <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 序列化的时候用来保存query传进来的字段名</span>
          fieldName []<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>
          aDebug    *debug.Debug
      }
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 节点信息</span>
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Element <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> { <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// SkipList每一个节点的值</span>
          key   document.DocId <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// cmapaignId</span>
          value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{} <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// value, 倒排中存入的是nil，正排中那个存入的是从mongo中读出来的对应字段的value值</span>
          next  []unsafe.Pointer <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 保存的是Skiplist每一层的元素</span>
      }

</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">倒排（invertIndex）:</li>
</ul>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">结构：由一个sync.map构成，其中key表示的是campaign字段名_从mongo中读取出来的对应字段名的值，value表示的是一个底层是一个skiplist，SkipList的每一个节点是一个ELement(见代码示例)，</li>
<li style="line-height: 160%; box-sizing: content-box;">对外接口:</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">@Params(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, 就是sync.<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>中的key)
  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> InvertedIndex <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span> { <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 倒排接口</span>
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 添加倒排元素</span>
      Add(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, id document.DocId) error
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 删除倒排元素</span>
      Del(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, id document.DocId) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 根据fieldName和id列表，新增倒排</span>
      Update(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, ids []document.DocId)
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 删除fieldName倒排</span>
      Delete(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>)
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 根据campaign字段名和传进的value值将SkipList生成迭代器，在query中遍历</span>
      Iterator(name, value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>) datastruct.Iterator
     <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 统计倒排的个数</span>
      Count() <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>
      <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 根据id获取索引字段</span>
      GetValueById(id document.DocId) []<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>
      DebugInfo() *debug.Debug
  }
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">正排（storageIndex）:
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">结构：由一个sync.map构成，其中key表示的是campaign字段名，value表示的是一个底层是一个skiplist，SkipList的每一个节点是一个ELement(见代码示例)。</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">对外接口:</li>
</ol>
</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">      @Params(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, 就是sync.<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>中的key)
      <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> StorageIndex <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span> {
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 根据fieldName和id获取对应的value</span>
        Get(filedName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, id document.DocId) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 添加正排节点</span>
        Add(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, id document.DocId, value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}) error
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 删除正排节点</span>
        Del(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>, id document.DocId) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 迭代器</span>
        Iterator(fieldName <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>) datastruct.Iterator
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 统计正排个数</span>
        Count() <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>
        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 获取字段名和value信息</span>
        GetValueById(id document.DocId) []<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>
        DebugInfo() *debug.Debug
    }
</code></pre>
<ol start="2" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">查询</li>
</ol>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">查询的过程就是一个对多个倒排链迭代的过程，query直接可以相互嵌套</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">查询接口</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">   <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Query <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span> {
       <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// next遍历</span>
       Next() (document.DocId, error)
       <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 获取当前的id值</span>
       Current() (document.DocId, error)
       <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 获取大于等于这个id值得最小值</span>
       GetGE(id document.DocId) (document.DocId, error)
       <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 序列化和反序列化</span>
       Marshal(idx *index.Indexer) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>[<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>]<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}
       Unmarshal(idx *index.Indexer, res <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>[<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>]<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}, e operation.Operation) Query
       DebugInfo() *debug.Debug
       SetDebug(isDebug ...<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>)
   }
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">查询包含四个实现，TermQuery，AndQuery，OrQuery，NotAndQuery</li>
</ul>
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">TermQuery本质上就是一个迭代器</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> TermQuery <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
      iterator datastruct.Iterator
      debugs   *debug.Debug
  }
</code></pre>
<ol start="2" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">AndQuery并集，一个id只有AndQuery里面的所有query都包含并且符合check条件才会被返回</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> AndQuery <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
      queries  []Query  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 传入多个query</span>
      checkers []check.Checker <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// check条件，用来判断id是否符合条件，必须所有的check返回true才可以</span>
      curIdx   <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span> <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 指示当前指针在哪个query上</span>
      debugs   *debug.Debug
  }
</code></pre>
<ol start="3" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">OrQuery交集，一个id只要在OrQuery中的任何一个query中出现并且符合check条件就会被返回</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 底层采用堆的方式实现</span>
  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Heap []Query
  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> OrQuery <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
      checkers []check.Checker <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// check条件，用来判断id是否符合条件，只有一个check满足即可</span>
      h        Heap  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 多个query</span>
      debugs   *debug.Debug
  }
</code></pre>
<ol start="4" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">NotAndQuery差集，在第一个query中出现，在其他query中没有出现的值并且符合check条件就会被返回</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">  <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> NotAndQuery <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
      queries  []Query <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 传入多个query</span>
      checkers []check.Checker <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// check条件，用来判断id是否符合条件，必须所有的check返回false才可以</span>
      curIdx   <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">int</span>
      debugs   *debug.Debug
  }
</code></pre>
<ol start="5" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal;">
<li style="line-height: 160%; box-sizing: content-box;">SqlQuery TODO</li>
</ol>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">check，check条件作用于正排，主语用来针对&gt;,&lt;,&gt;=,&lt;=等操作符的过滤，包含AndCheck，OrCheck，NotCheck，InCheck，CheckImpl
<ol style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">接口：</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Checker <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span> {
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 判断id是否符合条件</span>
         Check(id document.DocId) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>
         DebugInfo() <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>
         Marshal(idx *index.Indexer) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>[<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>]<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}
         Unmarshal(idx *index.Indexer, res <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">map</span>[<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">string</span>]<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}, e operation.Operation) Checker
     }
</code></pre>
<ol start="2" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">CheckImpl</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> CheckerImpl <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 正排链</span>
         si       datastruct.Iterator
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 判断的value值，condition传进来的比较值</span>
         value    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 操作符</span>
         op       operation.OP
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 对于特别复杂的类型比较时，采用自定义operation的方式来实现</span>
         e        operation.Operation
         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 同上</span>
         transfer <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>
     }
</code></pre>
<ol start="3" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">InCheck 针对传进来的value值为切片或者复杂类型的情况, 只要正排中取出来的值在value中出现就返回true</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> InChecker <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
     si       datastruct.Iterator
     value    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}
     e        operation.Operation
     transfer <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>
 }
</code></pre>
<ol start="4" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">NotCheck 针对传进来的value值为切片或者复杂类型的情况, 只要正排中取出来的值在value中出现就返回false</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> InChecker <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
     si       datastruct.Iterator
     value    <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}
     e        operation.Operation
     transfer <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>
 }
</code></pre>
<ol start="5" style="line-height: 160%; box-sizing: content-box; display: block; padding-left: 30px; margin: 6px 0 10px; color: #333; list-style-type: decimal; margin-top: 0; margin-bottom: 0;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">AndCheck和OrCheck就是上面三个check条件的组合，andCheck必须所有的check条件都返回true才返回true，orCheck只要有一个check返回true就返回true</li>
</ol>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> AndChecker <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// AndCheck</span>
         c      []Checker
         aDebug *debug.Debug
     }
     <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> AndChecker <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> { <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// OrCheck</span>
         c      []Checker
         aDebug *debug.Debug
     }
</code></pre>
</li>
<li style="line-height: 160%; box-sizing: content-box; position: relative;">operation</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">
   <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">//check中支持的操作符</span>
   <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">const</span> (
       EQ  = <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">iota</span> <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 相等</span>
       NE         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 不等</span>
       LE         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 小于等于</span>
       GE         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 大于等于</span>
       LT         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 小于</span>
       GT         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 大于</span>
       AND        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 与</span>
       OR         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 或</span>
       NOT        <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 非</span>
       IN         <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 范围</span>
   )
   <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Operation <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span> {
       Equal(value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// =接口</span>
       Less(value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>   <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// &lt;接口</span>
       In(value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{}) <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bool</span>    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// in接口</span>
       SetValue(value <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{})   <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 使用自定义operation时使用</span>
       由上述三个接口组合可以实现=,!=,&gt;,&gt;=,&lt;,&lt;=等操作
   }
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">search</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">   <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">type</span> Searcher <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">struct</span> {
       Docs       []document.DocId  <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 返回的id列表</span>
       Time       time.Duration    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 查询耗时</span>
       IndexDebug *debug.Debug      
       QueryDebug *debug.Debug
   }
   <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// 查询</span>
   <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">func</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(s *Searcher)</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">Search</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(iIndexer *index.Indexer, query query.Query)</span></span> {}
</code></pre>
<ul style="line-height: 160%; box-sizing: content-box; display: block; list-style-type: disc; padding-left: 30px; margin: 6px 0 10px; color: #333;">
<li style="line-height: 160%; box-sizing: content-box; position: relative;">builder, 通过mongo中读取数据生成索引的流程</li>
</ul>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;">ctx, cancel := context.WithCancel(context.Background())
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">defer</span> cancel()
	<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// build index</span>
b, e := builder.NewMongoIndexBuilder(&amp;builder.MongoIndexManagerOps{
		URI:            <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"mongodb://13.250.108.190:27017"</span>,
		IncInterval:    <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>,
		BaseInterval:   <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">120</span>,
		IncParser:      &amp;CampaignParser{},
		BaseParser:     &amp;CampaignParser{},
		BaseQuery:      bson.M{<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"status"</span>: <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">1</span>},
		DB:             <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"new_adn"</span>,
		Collection:     <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"campaign"</span>,
		ConnectTimeout: <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">10000</span>,
		ReadTimeout:    <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">20000</span>,
		UserData:       &amp;UserData{},
		Logger:         logrus.New(),
		OnBeforeInc: <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">func</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(userData <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">interface</span>{})</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">interface</span></span>{} {
			ud, ok := userData.(*UserData)
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> !ok {
				<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">nil</span>
			}
			incQuery := bson.M{<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"updated"</span>: bson.M{<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"$gte"</span>: ud.upTime - <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;">5</span>, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"$lte"</span>: time.Now().Unix()}}
			<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> incQuery
		},
	})
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> e != <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">nil</span> {
		fmt.Println(e)
		<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span>
	}
	<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">if</span> e := b.Build(ctx, <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"indexName"</span>); e != <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">nil</span> {
		fmt.Println(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">"build error"</span>, e.Error())
	}
    <span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// index</span>
	tIndex := b.GetIndex()
	<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// invert list</span>
	invertIdx := tIndex.GetInvertedIndex()
	<span style="color: #57a64a; font-style: italic; line-height: 160%; box-sizing: content-box;">// storage</span>
	storageIdx := tIndex.GetStorageIndex()
</code></pre>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%20Juno%E6%96%87%E6%A1%A3%E8%AF%B4%E6%98%8E%0A%23%23%20%E4%B8%80.%20SkipList(%E8%B7%B3%E8%B7%83%E8%A1%A8)%0A1.%20SkipList%E6%98%AF%E4%B8%80%E7%A7%8D%E9%9A%8F%E6%9C%BA%E5%8C%96%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E5%9F%BA%E4%BA%8E%E5%B9%B6%E8%81%94%E7%9A%84%E9%93%BE%E8%A1%A8%EF%BC%8C%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%EF%BC%8C%E6%8F%92%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E6%9F%A5%E6%89%BE%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%9D%87%E4%B8%BAO(logN)%2C%E6%80%A7%E8%83%BD%E4%B8%8E%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9B%B8%E5%BD%93%EF%BC%8C%E4%B8%94%E5%AE%9E%E7%8E%B0%E8%BE%83%E4%B8%BA%E7%AE%80%E5%8D%95%EF%BC%8C%E5%9B%A0%E6%AD%A4%E5%9C%A8%E5%BE%88%E5%A4%9A%E8%91%97%E5%90%8D%E9%A1%B9%E7%9B%AE%E9%83%BD%E7%94%A8%E8%B7%B3%E8%A1%A8%E6%9D%A5%E4%BB%A3%E6%9B%BF%E7%BA%A2%E9%BB%91%E6%A0%91%EF%BC%8C%E4%BE%8B%E5%A6%82LevelDB%E3%80%81Reddis%E7%9A%84%E5%BA%95%E5%B1%82%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%B0%B1%E6%98%AF%E7%94%A8%E7%9A%84SkipList%E3%80%82%0A2.%20SkipList%E7%9A%84%E7%89%B9%E5%BE%81%3A%0A%20-%20%E4%B8%80%E4%B8%AA%E8%B7%B3%E8%A1%A8%E5%BA%94%E8%AF%A5%E7%94%B1%E5%87%A0%E4%B8%AA%E5%B1%82%EF%BC%88level%EF%BC%89%E7%BB%84%E6%88%90%EF%BC%8CJuno%E4%B8%AD%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A812%E5%B1%82%E3%80%82%0A%20-%20%E8%B7%B3%E8%A1%A8%E7%9A%84%E7%AC%AC0%E5%B1%82%E5%8C%85%E5%90%AB%E6%89%80%E6%9C%89%E7%9A%84%E5%85%83%E7%B4%A0%EF%BC%8C%E8%8A%82%E7%82%B9%E5%80%BC%E6%98%AF%E6%9C%89%E5%BA%8F%E7%9A%84%EF%BC%8Cjuno%E8%8A%82%E7%82%B9%E4%BF%9D%E5%AD%98%E7%9A%84%E6%98%AFELement%E5%85%83%E7%B4%A0%EF%BC%8C%E6%A0%B9%E6%8D%AEElement%E4%B8%AD%E7%9A%84id(campaignId)%E6%9D%A5%E6%8E%92%E5%BA%8F%E3%80%82%0A%20-%20%E6%AF%8F%E4%B8%80%E5%B1%82%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9C%89%E5%BA%8F%E7%9A%84%E9%93%BE%E8%A1%A8%EF%BC%8C%E5%B1%82%E6%95%B0%E8%B6%8A%E9%AB%98%EF%BC%8C%E8%8A%82%E7%82%B9%E6%95%B0%E8%B6%8A%E5%B0%91%E3%80%82%0A%20-%20%E5%A6%82%E6%9E%9C%E5%85%83%E7%B4%A0x%E5%87%BA%E7%8E%B0%E5%9C%A8%E7%AC%ACi%E5%B1%82%EF%BC%8C%E5%88%99%E6%89%80%E6%9C%89%E6%AF%94i%E5%B0%8F%E7%9A%84%E5%B1%82%E9%83%BD%E5%8C%85%E5%90%ABx%E3%80%82%0A%20-%20%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E5%8C%85%E5%90%ABkey%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E7%9A%84value%E5%92%8C%E4%B8%80%E4%B8%AA%E6%8C%87%E5%90%91%E8%AF%A5%E8%8A%82%E7%82%B9%E7%AC%ACn%E5%B1%82%E7%9A%84%E4%B8%8B%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E6%8C%87%E9%92%88%E6%95%B0%E7%BB%84%E8%A1%A8%E7%A4%BA%E7%AC%AClevel%E5%B1%82%E7%9A%84x%E7%9A%84%E4%B8%8B%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E3%80%82%0A3.%20SkipList%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%BF%87%E7%A8%8B%3A%0A%20%20%E5%81%87%E8%AE%BESKipList%E4%B8%AD%E5%8C%85%E5%90%AB13%E3%80%8122%E3%80%8175%E3%80%8180%E3%80%8199%E8%BF%99%E5%87%A0%E4%B8%AA%E5%85%83%E7%B4%A0%EF%BC%8C%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A080%E7%9A%84%E8%BF%87%E7%A8%8B%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%0A%20!%5Bavatar%5D(https%3A%2F%2Fsegmentfault.com%2Fimg%2FbVbpAok%3Fw%3D869%26h%3D453)%0A4.%20SkipList%E7%9A%84%E6%8F%92%E5%85%A5%E8%BF%87%E7%A8%8B%3A%0A%20%20!%5Bavatar%5D(https%3A%2F%2Fsegmentfault.com%2Fimg%2FbVbpAoj%3Fw%3D814%26h%3D398)%0A%23%23%20%E4%BA%8C.%20juno%E7%9A%84document%E4%BF%A1%E6%81%AF%0A%60%60%60go%0Atype%20Field%20struct%20%7B%0A%09Name%20%20%20%20%20%20string%20%20%20%20%2F%2F%20campaign%E7%9A%84%E5%AD%97%E6%AE%B5%E5%90%8D%0A%09IndexType%20IndexType%20%20%2F%2F%20%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B%EF%BC%8C1.%E5%80%92%E6%8E%92%2C2.%E6%AD%A3%E6%8E%92%2C3.%E4%B8%A4%E4%B8%AA%E9%83%BD%E5%BB%BA%0A%09Value%20%20%20%20%20interface%7B%7D%20%2F%2F%20campaign%E5%AD%97%E6%AE%B5%E5%90%8D%E5%AF%B9%E5%BA%94%E7%9A%84%E5%80%BC%0A%20%20%20%20%20%20%20%20ValueType%20FieldType%20%2F%2F%20value%E5%80%BC%E5%BE%97%E7%B1%BB%E5%9E%8B(%E7%B1%BBsql%E8%AF%AD%E6%B3%95%E4%B8%AD%E4%BD%BF%E7%94%A8)%0A%7D%0A%0Atype%20DocInfo%20struct%20%7B%20%2F%2F%20juno%E6%96%87%E6%A1%A3%E7%BB%93%E6%9E%84%0A%09Id%20%20%20%20%20DocId%20%20%20%2F%2F%20campaignId%0A%09Fields%20%5B%5D*Field%20%2F%2F%20%E5%AF%B9%E5%BA%94%E4%B8%80%E6%9D%A1%E6%9F%A5%E8%AF%A2%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89Field%E4%BF%A1%E6%81%AF%0A%7D%0A%0A%2F%2F%20eg%3A%20%0A%20%20type%20CampaignInfo%20struct%20%7B%0A%09CampaignId%20%20%20%20%20int64%20%20%20%20%60bson%3A%22campaignId%2Comitempty%22%20json%3A%22campaignId%2Comitempty%22%60%0A%09AdvertiserId%20%20%20*int32%20%20%20%60bson%3A%22advertiserId%2Comitempty%22%20json%3A%22advertiserId%2Comitempty%22%60%0A%09CampaignType%20%20%20*int32%20%20%20%60bson%3A%22campaignType%2Comitempty%22%20json%3A%22campaignType%2Comitempty%22%60%0A%7D%0A%20%20%20%20var%20info%20*CampaignInfo%0A%20%20%20%20var%20doc1%20%3D%20%26document.DocInfo%7B%0A%20%20%20%20%20%20%20%20Id%3A%20campaign.CampaignId%2C%0A%20%20%20%20%20%20%20%20Fields%3A%20%5B%5D*document.Field%7B%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20Name%3A%20%20%20%20%20%20%22AdvertiserId%22%2C%0A%09%09%09IndexType%3A%20storageIndexType%2C%0A%09%09%09Value%3A%20%20%20%20*info.AdvertiserId%2C%0A%09%09%09ValueType%3A%20document.IntFieldType%2C%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%09Name%3A%20%20%20%20%20%20%22CampaignType%22%2C%0A%09%09%09IndexType%3A%20invertIndexType%2C%0A%09%09%09Value%3A%20%20%20%20%20int64(*info.CampaignType)%2C%0A%09%09%09ValueType%3A%20document.IntFieldType%2C%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20...%0A%20%20%20%20%7D%0A%60%60%60%0A%E5%9C%A8%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E9%A6%96%E5%85%88%E5%B0%86campaign%E7%9A%84%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF%E8%BD%AC%E6%8D%A2%E4%B8%BAdocInfo%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%9C%A8%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%2C%E5%80%92%E6%8E%92%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8int64%2Cstring%2C%5B%5Dint64%2C%5B%5Dstring%2C%E5%BA%95%E5%B1%82%E9%83%BD%E4%BC%9A%E8%BD%AC%E6%8D%A2%E6%88%90string%E5%AE%9E%E7%8E%B0%EF%BC%8C%E6%AD%A3%E6%8E%92%E6%94%AF%E6%8C%81%E4%BB%BB%E6%84%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%AD%97%E6%AE%B5%E3%80%82%0A%23%23%20%E4%B8%89.%20Juno%E7%9A%84%E7%BB%84%E6%88%90%0A%E4%B8%BB%E8%A6%81%E5%8C%85%E5%90%AB%E4%B8%A4%E4%B8%AA%E9%83%A8%E5%88%86%EF%BC%8C%E7%B4%A2%E5%BC%95%EF%BC%88index%EF%BC%89%E5%92%8C%E6%9F%A5%E8%AF%A2%EF%BC%88query%EF%BC%89%0A1.%20%E7%B4%A2%E5%BC%95%EF%BC%88index%EF%BC%89%3A%20%E7%94%B1%E5%80%92%E6%8E%92%E5%92%8C%E6%AD%A3%E6%8E%92%E4%B8%A4%E4%B8%AA%E9%83%A8%E5%88%86%E7%BB%84%E6%88%90%0A%20%20%60%60%60go%0A%20%20%20%20%20%20%20%20%2F%2F%20%E7%B4%A2%E5%BC%95%E6%8E%A5%E5%8F%A3%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20type%20Index%20interface%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%96%B0%E5%A2%9E%E6%96%87%E6%A1%A3%0A%20%20%20%20%20%20%20%20%20%20%20%20Add(docInfo%20*document.DocInfo)%20error%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3%0A%20%20%20%20%20%20%20%20%20%20%20%20Del(docInfo%20*document.DocInfo)%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%8E%B7%E5%8F%96%E4%B8%8A%E9%9D%A2FIeld%E4%B8%ADValueType%E7%9A%84%E4%BF%A1%E6%81%AF(%E7%B1%BBsql%E4%B8%AD%E4%BD%BF%E7%94%A8)%0A%20%20%20%20%20%20%20%20%20%20%20%20GetDataType(fieldName%20string)%20document.FieldType%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%A0%B9%E6%8D%AEid%E8%8E%B7%E5%8F%96%E7%B4%A2%E5%BC%95%E5%AD%97%E6%AE%B5%0A%20%20%20%20%20%20%20%20%20%20%20%20GetValueById(id%20document.DocId)%20map%5Bstring%5D%5B%5Dstring%0A%20%20%20%20%20%20%20%20%20%20%20%20Dump(filename%20string)%20error%0A%20%20%20%20%20%20%20%20%20%20%20%20Load(filename%20string)%20error%0A%20%20%20%20%20%20%20%20%20%20%20%20DebugInfo()%20*debug.Debug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20eg%3A%20index.Add(info)%0A%20%20%20%20%20%20%20%20%2F%2F%20%E5%80%92%E6%8E%92%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20type%20InvertedIndexer%20struct%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20data%20%20%20sync.Map%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%97%B6%E5%80%99%E7%94%A8%E6%9D%A5%E4%BF%9D%E5%AD%98query%E4%BC%A0%E8%BF%9B%E6%9D%A5%E7%9A%84%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8Ccondition%E5%80%BC%0A%20%20%20%20%20%20%20%20%20%20%20%20field%20%20%5B%5Dstring%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20value%20%20%5B%5Dstring%0A%20%20%20%20%20%20%20%20%20%20%20%20aDebug%20*debug.Debug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%AD%A3%E6%8E%92%E7%BB%93%E6%9E%84%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20type%20StorageIndexer%20struct%20%7B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20data%20%20%20%20%20%20sync.Map%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E6%97%B6%E5%80%99%E7%94%A8%E6%9D%A5%E4%BF%9D%E5%AD%98query%E4%BC%A0%E8%BF%9B%E6%9D%A5%E7%9A%84%E5%AD%97%E6%AE%B5%E5%90%8D%0A%20%20%20%20%20%20%20%20%20%20%20%20fieldName%20%5B%5Dstring%0A%20%20%20%20%20%20%20%20%20%20%20%20aDebug%20%20%20%20*debug.Debug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20type%20Element%20struct%20%7B%20%2F%2F%20SkipList%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E7%9A%84%E5%80%BC%0A%20%20%20%20%20%20%20%20%20%20%20%20key%20%20%20document.DocId%20%2F%2F%20cmapaignId%0A%20%20%20%20%20%20%20%20%20%20%20%20value%20interface%7B%7D%20%2F%2F%20value%2C%20%E5%80%92%E6%8E%92%E4%B8%AD%E5%AD%98%E5%85%A5%E7%9A%84%E6%98%AFnil%EF%BC%8C%E6%AD%A3%E6%8E%92%E4%B8%AD%E9%82%A3%E4%B8%AA%E5%AD%98%E5%85%A5%E7%9A%84%E6%98%AF%E4%BB%8Emongo%E4%B8%AD%E8%AF%BB%E5%87%BA%E6%9D%A5%E7%9A%84%E5%AF%B9%E5%BA%94%E5%AD%97%E6%AE%B5%E7%9A%84value%E5%80%BC%0A%20%20%20%20%20%20%20%20%20%20%20%20next%20%20%5B%5Dunsafe.Pointer%20%2F%2F%20%E4%BF%9D%E5%AD%98%E7%9A%84%E6%98%AFSkiplist%E6%AF%8F%E4%B8%80%E5%B1%82%E7%9A%84%E5%85%83%E7%B4%A0%0A%20%20%20%20%20%20%20%20%7D%0A%20%0A%20%60%60%60%0A%20-%20%E5%80%92%E6%8E%92%EF%BC%88invertIndex%EF%BC%89%3A%0A%20%201.%20%E7%BB%93%E6%9E%84%EF%BC%9A%E7%94%B1%E4%B8%80%E4%B8%AAsync.map%E6%9E%84%E6%88%90%EF%BC%8C%E5%85%B6%E4%B8%ADkey%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%98%AFcampaign%E5%AD%97%E6%AE%B5%E5%90%8D_%E4%BB%8Emongo%E4%B8%AD%E8%AF%BB%E5%8F%96%E5%87%BA%E6%9D%A5%E7%9A%84%E5%AF%B9%E5%BA%94%E5%AD%97%E6%AE%B5%E5%90%8D%E7%9A%84%E5%80%BC%EF%BC%8Cvalue%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BA%95%E5%B1%82%E6%98%AF%E4%B8%80%E4%B8%AAskiplist%EF%BC%8CSkipList%E7%9A%84%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E6%98%AF%E4%B8%80%E4%B8%AAELement(%E8%A7%81%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B)%EF%BC%8C%0A%20%202.%20%E5%AF%B9%E5%A4%96%E6%8E%A5%E5%8F%A3%3A%0A%20%20%60%60%60go%0A%20%20%40Params(fieldName%20string%2C%20%E5%B0%B1%E6%98%AFsync.map%E4%B8%AD%E7%9A%84key)%0A%20%20%20%20type%20InvertedIndex%20interface%20%7B%20%2F%2F%20%E5%80%92%E6%8E%92%E6%8E%A5%E5%8F%A3%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%B7%BB%E5%8A%A0%E5%80%92%E6%8E%92%E5%85%83%E7%B4%A0%0A%20%20%20%20%20%20%20%20Add(fieldName%20string%2C%20id%20document.DocId)%20error%0A%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%A0%E9%99%A4%E5%80%92%E6%8E%92%E5%85%83%E7%B4%A0%0A%20%20%20%20%20%20%20%20Del(fieldName%20string%2C%20id%20document.DocId)%20bool%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%A0%B9%E6%8D%AEfieldName%E5%92%8Cid%E5%88%97%E8%A1%A8%EF%BC%8C%E6%96%B0%E5%A2%9E%E5%80%92%E6%8E%92%0A%20%20%20%20%20%20%20%20Update(fieldName%20string%2C%20ids%20%5B%5Ddocument.DocId)%0A%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%A0%E9%99%A4fieldName%E5%80%92%E6%8E%92%0A%20%20%20%20%20%20%20%20Delete(fieldName%20string)%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%A0%B9%E6%8D%AEcampaign%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8C%E4%BC%A0%E8%BF%9B%E7%9A%84value%E5%80%BC%E5%B0%86SkipList%E7%94%9F%E6%88%90%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%8C%E5%9C%A8query%E4%B8%AD%E9%81%8D%E5%8E%86%0A%20%20%20%20%20%20%20%20Iterator(name%2C%20value%20string)%20datastruct.Iterator%0A%20%20%20%20%20%20%20%2F%2F%20%E7%BB%9F%E8%AE%A1%E5%80%92%E6%8E%92%E7%9A%84%E4%B8%AA%E6%95%B0%0A%20%20%20%20%20%20%20%20Count()%20int%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%A0%B9%E6%8D%AEid%E8%8E%B7%E5%8F%96%E7%B4%A2%E5%BC%95%E5%AD%97%E6%AE%B5%0A%20%20%20%20%20%20%20%20GetValueById(id%20document.DocId)%20%5B%5Dstring%0A%20%20%20%20%20%20%20%20DebugInfo()%20*debug.Debug%0A%20%20%20%20%7D%0A%20%60%60%60%0A-%20%E6%AD%A3%E6%8E%92%EF%BC%88storageIndex%EF%BC%89%3A%0A%20%201.%20%E7%BB%93%E6%9E%84%EF%BC%9A%E7%94%B1%E4%B8%80%E4%B8%AAsync.map%E6%9E%84%E6%88%90%EF%BC%8C%E5%85%B6%E4%B8%ADkey%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%98%AFcampaign%E5%AD%97%E6%AE%B5%E5%90%8D%EF%BC%8Cvalue%E8%A1%A8%E7%A4%BA%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BA%95%E5%B1%82%E6%98%AF%E4%B8%80%E4%B8%AAskiplist%EF%BC%8CSkipList%E7%9A%84%E6%AF%8F%E4%B8%80%E4%B8%AA%E8%8A%82%E7%82%B9%E6%98%AF%E4%B8%80%E4%B8%AAELement(%E8%A7%81%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B)%E3%80%82%0A%20%202.%20%E5%AF%B9%E5%A4%96%E6%8E%A5%E5%8F%A3%3A%0A%60%60%60go%0A%20%20%20%20%20%20%40Params(fieldName%20string%2C%20%E5%B0%B1%E6%98%AFsync.map%E4%B8%AD%E7%9A%84key)%0A%20%20%20%20%20%20type%20StorageIndex%20interface%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%A0%B9%E6%8D%AEfieldName%E5%92%8Cid%E8%8E%B7%E5%8F%96%E5%AF%B9%E5%BA%94%E7%9A%84value%0A%20%20%20%20%20%20%20%20Get(filedName%20string%2C%20id%20document.DocId)%20interface%7B%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20%E6%B7%BB%E5%8A%A0%E6%AD%A3%E6%8E%92%E8%8A%82%E7%82%B9%0A%20%20%20%20%20%20%20%20Add(fieldName%20string%2C%20id%20document.DocId%2C%20value%20interface%7B%7D)%20error%0A%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%A0%E9%99%A4%E6%AD%A3%E6%8E%92%E8%8A%82%E7%82%B9%0A%20%20%20%20%20%20%20%20Del(fieldName%20string%2C%20id%20document.DocId)%20bool%0A%20%20%20%20%20%20%20%20%2F%2F%20%E8%BF%AD%E4%BB%A3%E5%99%A8%0A%20%20%20%20%20%20%20%20Iterator(fieldName%20string)%20datastruct.Iterator%0A%20%20%20%20%20%20%20%20%2F%2F%20%E7%BB%9F%E8%AE%A1%E6%AD%A3%E6%8E%92%E4%B8%AA%E6%95%B0%0A%20%20%20%20%20%20%20%20Count()%20int%0A%20%20%20%20%20%20%20%20%2F%2F%20%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8Cvalue%E4%BF%A1%E6%81%AF%0A%20%20%20%20%20%20%20%20GetValueById(id%20document.DocId)%20%5B%5Dstring%0A%20%20%20%20%20%20%20%20DebugInfo()%20*debug.Debug%0A%20%20%20%20%7D%0A%20%20%60%60%60%0A2.%20%E6%9F%A5%E8%AF%A2%0A%20-%20%E6%9F%A5%E8%AF%A2%E7%9A%84%E8%BF%87%E7%A8%8B%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E5%AF%B9%E5%A4%9A%E4%B8%AA%E5%80%92%E6%8E%92%E9%93%BE%E8%BF%AD%E4%BB%A3%E7%9A%84%E8%BF%87%E7%A8%8B%EF%BC%8Cquery%E7%9B%B4%E6%8E%A5%E5%8F%AF%E4%BB%A5%E7%9B%B8%E4%BA%92%E5%B5%8C%E5%A5%97%0A%20-%20%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3%0A%20%60%60%60go%0A%20%20%20%20type%20Query%20interface%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20next%E9%81%8D%E5%8E%86%0A%20%20%20%20%20%20%20%20Next()%20(document.DocId%2C%20error)%0A%20%20%20%20%20%20%20%20%2F%2F%20%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%9A%84id%E5%80%BC%0A%20%20%20%20%20%20%20%20Current()%20(document.DocId%2C%20error)%0A%20%20%20%20%20%20%20%20%2F%2F%20%E8%8E%B7%E5%8F%96%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%E8%BF%99%E4%B8%AAid%E5%80%BC%E5%BE%97%E6%9C%80%E5%B0%8F%E5%80%BC%0A%20%20%20%20%20%20%20%20GetGE(id%20document.DocId)%20(document.DocId%2C%20error)%0A%20%20%20%20%20%20%20%20%2F%2F%20%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%0A%20%20%20%20%20%20%20%20Marshal(idx%20*index.Indexer)%20map%5Bstring%5Dinterface%7B%7D%0A%20%20%20%20%20%20%20%20Unmarshal(idx%20*index.Indexer%2C%20res%20map%5Bstring%5Dinterface%7B%7D%2C%20e%20operation.Operation)%20Query%0A%20%20%20%20%20%20%20%20DebugInfo()%20*debug.Debug%0A%20%20%20%20%20%20%20%20SetDebug(isDebug%20...int)%0A%20%20%20%20%7D%0A%20%60%60%60%0A%20-%20%E6%9F%A5%E8%AF%A2%E5%8C%85%E5%90%AB%E5%9B%9B%E4%B8%AA%E5%AE%9E%E7%8E%B0%EF%BC%8CTermQuery%EF%BC%8CAndQuery%EF%BC%8COrQuery%EF%BC%8CNotAndQuery%0A%20%201.%20TermQuery%E6%9C%AC%E8%B4%A8%E4%B8%8A%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8%0A%20%20%60%60%60go%0A%20%20%20%20type%20TermQuery%20struct%20%7B%0A%20%20%20%20%20%20%20%20iterator%20datastruct.Iterator%0A%20%20%20%20%20%20%20%20debugs%20%20%20*debug.Debug%0A%20%20%20%20%7D%0A%20%20%60%60%60%0A%20%202.%20AndQuery%E5%B9%B6%E9%9B%86%EF%BC%8C%E4%B8%80%E4%B8%AAid%E5%8F%AA%E6%9C%89AndQuery%E9%87%8C%E9%9D%A2%E7%9A%84%E6%89%80%E6%9C%89query%E9%83%BD%E5%8C%85%E5%90%AB%E5%B9%B6%E4%B8%94%E7%AC%A6%E5%90%88check%E6%9D%A1%E4%BB%B6%E6%89%8D%E4%BC%9A%E8%A2%AB%E8%BF%94%E5%9B%9E%0A%20%20%60%60%60go%0A%20%20%20%20type%20AndQuery%20struct%20%7B%0A%20%20%20%20%20%20%20%20queries%20%20%5B%5DQuery%20%20%2F%2F%20%E4%BC%A0%E5%85%A5%E5%A4%9A%E4%B8%AAquery%0A%20%20%20%20%20%20%20%20checkers%20%5B%5Dcheck.Checker%20%2F%2F%20check%E6%9D%A1%E4%BB%B6%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%88%A4%E6%96%ADid%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%89%80%E6%9C%89%E7%9A%84check%E8%BF%94%E5%9B%9Etrue%E6%89%8D%E5%8F%AF%E4%BB%A5%0A%20%20%20%20%20%20%20%20curIdx%20%20%20int%20%2F%2F%20%E6%8C%87%E7%A4%BA%E5%BD%93%E5%89%8D%E6%8C%87%E9%92%88%E5%9C%A8%E5%93%AA%E4%B8%AAquery%E4%B8%8A%0A%20%20%20%20%20%20%20%20debugs%20%20%20*debug.Debug%0A%20%20%20%20%7D%0A%20%20%60%60%60%0A%20%203.%20OrQuery%E4%BA%A4%E9%9B%86%EF%BC%8C%E4%B8%80%E4%B8%AAid%E5%8F%AA%E8%A6%81%E5%9C%A8OrQuery%E4%B8%AD%E7%9A%84%E4%BB%BB%E4%BD%95%E4%B8%80%E4%B8%AAquery%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%B9%B6%E4%B8%94%E7%AC%A6%E5%90%88check%E6%9D%A1%E4%BB%B6%E5%B0%B1%E4%BC%9A%E8%A2%AB%E8%BF%94%E5%9B%9E%0A%20%20%60%60%60go%0A%20%20%20%20%2F%2F%20%E5%BA%95%E5%B1%82%E9%87%87%E7%94%A8%E5%A0%86%E7%9A%84%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0%0A%20%20%20%20type%20Heap%20%5B%5DQuery%0A%20%20%20%20type%20OrQuery%20struct%20%7B%0A%20%20%20%20%20%20%20%20checkers%20%5B%5Dcheck.Checker%20%2F%2F%20check%E6%9D%A1%E4%BB%B6%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%88%A4%E6%96%ADid%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%EF%BC%8C%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AAcheck%E6%BB%A1%E8%B6%B3%E5%8D%B3%E5%8F%AF%0A%20%20%20%20%20%20%20%20h%20%20%20%20%20%20%20%20Heap%20%20%2F%2F%20%E5%A4%9A%E4%B8%AAquery%0A%20%20%20%20%20%20%20%20debugs%20%20%20*debug.Debug%0A%20%20%20%20%7D%0A%20%20%60%60%60%0A%20%204.%20NotAndQuery%E5%B7%AE%E9%9B%86%EF%BC%8C%E5%9C%A8%E7%AC%AC%E4%B8%80%E4%B8%AAquery%E4%B8%AD%E5%87%BA%E7%8E%B0%EF%BC%8C%E5%9C%A8%E5%85%B6%E4%BB%96query%E4%B8%AD%E6%B2%A1%E6%9C%89%E5%87%BA%E7%8E%B0%E7%9A%84%E5%80%BC%E5%B9%B6%E4%B8%94%E7%AC%A6%E5%90%88check%E6%9D%A1%E4%BB%B6%E5%B0%B1%E4%BC%9A%E8%A2%AB%E8%BF%94%E5%9B%9E%0A%20%20%60%60%60go%0A%20%20%20%20type%20NotAndQuery%20struct%20%7B%0A%20%20%20%20%20%20%20%20queries%20%20%5B%5DQuery%20%2F%2F%20%E4%BC%A0%E5%85%A5%E5%A4%9A%E4%B8%AAquery%0A%20%20%20%20%20%20%20%20checkers%20%5B%5Dcheck.Checker%20%2F%2F%20check%E6%9D%A1%E4%BB%B6%EF%BC%8C%E7%94%A8%E6%9D%A5%E5%88%A4%E6%96%ADid%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%EF%BC%8C%E5%BF%85%E9%A1%BB%E6%89%80%E6%9C%89%E7%9A%84check%E8%BF%94%E5%9B%9Efalse%E6%89%8D%E5%8F%AF%E4%BB%A5%0A%20%20%20%20%20%20%20%20curIdx%20%20%20int%0A%20%20%20%20%20%20%20%20debugs%20%20%20*debug.Debug%0A%20%20%20%20%7D%0A%20%20%60%60%60%0A%20%20%0A%20%205.%20SqlQuery%20TODO%0A%20-%20check%EF%BC%8Ccheck%E6%9D%A1%E4%BB%B6%E4%BD%9C%E7%94%A8%E4%BA%8E%E6%AD%A3%E6%8E%92%EF%BC%8C%E4%B8%BB%E8%AF%AD%E7%94%A8%E6%9D%A5%E9%92%88%E5%AF%B9%3E%2C%3C%2C%3E%3D%2C%3C%3D%E7%AD%89%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E8%BF%87%E6%BB%A4%EF%BC%8C%E5%8C%85%E5%90%ABAndCheck%EF%BC%8COrCheck%EF%BC%8CNotCheck%EF%BC%8CInCheck%EF%BC%8CCheckImpl%0A%20%20%201.%20%E6%8E%A5%E5%8F%A3%EF%BC%9A%0A%20%20%20%60%60%60go%0A%20%20%20%20%20%20%20%20type%20Checker%20interface%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%A4%E6%96%ADid%E6%98%AF%E5%90%A6%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%0A%20%20%20%20%20%20%20%20%20%20%20%20Check(id%20document.DocId)%20bool%0A%20%20%20%20%20%20%20%20%20%20%20%20DebugInfo()%20string%0A%20%20%20%20%20%20%20%20%20%20%20%20Marshal(idx%20*index.Indexer)%20map%5Bstring%5Dinterface%7B%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20Unmarshal(idx%20*index.Indexer%2C%20res%20map%5Bstring%5Dinterface%7B%7D%2C%20e%20operation.Operation)%20Checker%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%60%60%60%0A%20%20%202.%20CheckImpl%0A%20%20%20%60%60%60go%0A%20%20%20%20%20%20%20%20type%20CheckerImpl%20struct%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%AD%A3%E6%8E%92%E9%93%BE%0A%20%20%20%20%20%20%20%20%20%20%20%20si%20%20%20%20%20%20%20datastruct.Iterator%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%88%A4%E6%96%AD%E7%9A%84value%E5%80%BC%EF%BC%8Ccondition%E4%BC%A0%E8%BF%9B%E6%9D%A5%E7%9A%84%E6%AF%94%E8%BE%83%E5%80%BC%0A%20%20%20%20%20%20%20%20%20%20%20%20value%20%20%20%20interface%7B%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%93%8D%E4%BD%9C%E7%AC%A6%0A%20%20%20%20%20%20%20%20%20%20%20%20op%20%20%20%20%20%20%20operation.OP%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%AF%B9%E4%BA%8E%E7%89%B9%E5%88%AB%E5%A4%8D%E6%9D%82%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83%E6%97%B6%EF%BC%8C%E9%87%87%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89operation%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E5%AE%9E%E7%8E%B0%0A%20%20%20%20%20%20%20%20%20%20%20%20e%20%20%20%20%20%20%20%20operation.Operation%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%90%8C%E4%B8%8A%0A%20%20%20%20%20%20%20%20%20%20%20%20transfer%20bool%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%60%60%60%0A%20%20%203.%20InCheck%20%E9%92%88%E5%AF%B9%E4%BC%A0%E8%BF%9B%E6%9D%A5%E7%9A%84value%E5%80%BC%E4%B8%BA%E5%88%87%E7%89%87%E6%88%96%E8%80%85%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%83%85%E5%86%B5%2C%20%E5%8F%AA%E8%A6%81%E6%AD%A3%E6%8E%92%E4%B8%AD%E5%8F%96%E5%87%BA%E6%9D%A5%E7%9A%84%E5%80%BC%E5%9C%A8value%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%B0%B1%E8%BF%94%E5%9B%9Etrue%0A%20%20%20%60%60%60go%0A%20%20%20%20type%20InChecker%20struct%20%7B%0A%20%20%20%20%20%20%20%20si%20%20%20%20%20%20%20datastruct.Iterator%0A%20%20%20%20%20%20%20%20value%20%20%20%20interface%7B%7D%0A%20%20%20%20%20%20%20%20e%20%20%20%20%20%20%20%20operation.Operation%0A%20%20%20%20%20%20%20%20transfer%20bool%0A%20%20%20%20%7D%0A%20%20%20%60%60%60%0A%20%20%20%204.%20NotCheck%20%E9%92%88%E5%AF%B9%E4%BC%A0%E8%BF%9B%E6%9D%A5%E7%9A%84value%E5%80%BC%E4%B8%BA%E5%88%87%E7%89%87%E6%88%96%E8%80%85%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%83%85%E5%86%B5%2C%20%E5%8F%AA%E8%A6%81%E6%AD%A3%E6%8E%92%E4%B8%AD%E5%8F%96%E5%87%BA%E6%9D%A5%E7%9A%84%E5%80%BC%E5%9C%A8value%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%B0%B1%E8%BF%94%E5%9B%9Efalse%0A%20%20%20%60%60%60go%0A%20%20%20%20type%20InChecker%20struct%20%7B%0A%20%20%20%20%20%20%20%20si%20%20%20%20%20%20%20datastruct.Iterator%0A%20%20%20%20%20%20%20%20value%20%20%20%20interface%7B%7D%0A%20%20%20%20%20%20%20%20e%20%20%20%20%20%20%20%20operation.Operation%0A%20%20%20%20%20%20%20%20transfer%20bool%0A%20%20%20%20%7D%0A%20%20%20%60%60%60%0A%20%20%205.%20AndCheck%E5%92%8COrCheck%E5%B0%B1%E6%98%AF%E4%B8%8A%E9%9D%A2%E4%B8%89%E4%B8%AAcheck%E6%9D%A1%E4%BB%B6%E7%9A%84%E7%BB%84%E5%90%88%EF%BC%8CandCheck%E5%BF%85%E9%A1%BB%E6%89%80%E6%9C%89%E7%9A%84check%E6%9D%A1%E4%BB%B6%E9%83%BD%E8%BF%94%E5%9B%9Etrue%E6%89%8D%E8%BF%94%E5%9B%9Etrue%EF%BC%8CorCheck%E5%8F%AA%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AAcheck%E8%BF%94%E5%9B%9Etrue%E5%B0%B1%E8%BF%94%E5%9B%9Etrue%0A%20%20%20%60%60%60go%0A%20%20%20%20%20%20%20%20type%20AndChecker%20struct%20%7B%20%20%2F%2F%20AndCheck%0A%20%20%20%20%20%20%20%20%20%20%20%20c%20%20%20%20%20%20%5B%5DChecker%0A%20%20%20%20%20%20%20%20%20%20%20%20aDebug%20*debug.Debug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20type%20AndChecker%20struct%20%7B%20%2F%2F%20OrCheck%0A%20%20%20%20%20%20%20%20%20%20%20%20c%20%20%20%20%20%20%5B%5DChecker%0A%20%20%20%20%20%20%20%20%20%20%20%20aDebug%20*debug.Debug%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%60%60%60%0A%20-%20operation%0A%20%60%60%60go%0A%0A%20%20%20%20%2F%2Fcheck%E4%B8%AD%E6%94%AF%E6%8C%81%E7%9A%84%E6%93%8D%E4%BD%9C%E7%AC%A6%0A%20%20%20%20const%20(%0A%20%20%20%20%20%20%20%20EQ%20%20%3D%20iota%20%2F%2F%20%E7%9B%B8%E7%AD%89%0A%20%20%20%20%20%20%20%20NE%20%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8D%E7%AD%89%0A%20%20%20%20%20%20%20%20LE%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%B0%8F%E4%BA%8E%E7%AD%89%E4%BA%8E%0A%20%20%20%20%20%20%20%20GE%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%A7%E4%BA%8E%E7%AD%89%E4%BA%8E%0A%20%20%20%20%20%20%20%20LT%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%B0%8F%E4%BA%8E%0A%20%20%20%20%20%20%20%20GT%20%20%20%20%20%20%20%20%20%2F%2F%20%E5%A4%A7%E4%BA%8E%0A%20%20%20%20%20%20%20%20AND%20%20%20%20%20%20%20%20%2F%2F%20%E4%B8%8E%0A%20%20%20%20%20%20%20%20OR%20%20%20%20%20%20%20%20%20%2F%2F%20%E6%88%96%0A%20%20%20%20%20%20%20%20NOT%20%20%20%20%20%20%20%20%2F%2F%20%E9%9D%9E%0A%20%20%20%20%20%20%20%20IN%20%20%20%20%20%20%20%20%20%2F%2F%20%E8%8C%83%E5%9B%B4%0A%20%20%20%20)%0A%20%20%20%20type%20Operation%20interface%20%7B%0A%09%20%20%20%20Equal(value%20interface%7B%7D)%20bool%20%20%2F%2F%20%3D%E6%8E%A5%E5%8F%A3%0A%20%20%20%20%20%20%20%20Less(value%20interface%7B%7D)%20bool%20%20%20%2F%2F%20%3C%E6%8E%A5%E5%8F%A3%0A%20%20%20%20%20%20%20%20In(value%20interface%7B%7D)%20bool%20%20%20%20%2F%2F%20in%E6%8E%A5%E5%8F%A3%0A%20%20%20%20%20%20%20%20SetValue(value%20interface%7B%7D)%20%20%20%2F%2F%20%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89operation%E6%97%B6%E4%BD%BF%E7%94%A8%0A%20%20%20%20%20%20%20%20%E7%94%B1%E4%B8%8A%E8%BF%B0%E4%B8%89%E4%B8%AA%E6%8E%A5%E5%8F%A3%E7%BB%84%E5%90%88%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%3D%2C!%3D%2C%3E%2C%3E%3D%2C%3C%2C%3C%3D%E7%AD%89%E6%93%8D%E4%BD%9C%0A%20%20%20%20%7D%0A%20%60%60%60%0A-%20search%0A%20%60%60%60go%0A%20%20%20%20type%20Searcher%20struct%20%7B%0A%20%20%20%20%20%20%20%20Docs%20%20%20%20%20%20%20%5B%5Ddocument.DocId%20%20%2F%2F%20%E8%BF%94%E5%9B%9E%E7%9A%84id%E5%88%97%E8%A1%A8%0A%20%20%20%20%20%20%20%20Time%20%20%20%20%20%20%20time.Duration%20%20%20%20%2F%2F%20%E6%9F%A5%E8%AF%A2%E8%80%97%E6%97%B6%0A%20%20%20%20%20%20%20%20IndexDebug%20*debug.Debug%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20QueryDebug%20*debug.Debug%0A%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20%E6%9F%A5%E8%AF%A2%0A%20%20%20%20func%20(s%20*Searcher)%20Search(iIndexer%20*index.Indexer%2C%20query%20query.Query)%20%7B%7D%0A%60%60%60%0A-%20builder%2C%20%E9%80%9A%E8%BF%87mongo%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90%E7%B4%A2%E5%BC%95%E7%9A%84%E6%B5%81%E7%A8%8B%0A%60%60%60go%0Actx%2C%20cancel%20%3A%3D%20context.WithCancel(context.Background())%0Adefer%20cancel()%0A%09%2F%2F%20build%20index%0Ab%2C%20e%20%3A%3D%20builder.NewMongoIndexBuilder(%26builder.MongoIndexManagerOps%7B%0A%09%09URI%3A%20%20%20%20%20%20%20%20%20%20%20%20%22mongodb%3A%2F%2F13.250.108.190%3A27017%22%2C%0A%09%09IncInterval%3A%20%20%20%205%2C%0A%09%09BaseInterval%3A%20%20%20120%2C%0A%09%09IncParser%3A%20%20%20%20%20%20%26CampaignParser%7B%7D%2C%0A%09%09BaseParser%3A%20%20%20%20%20%26CampaignParser%7B%7D%2C%0A%09%09BaseQuery%3A%20%20%20%20%20%20bson.M%7B%22status%22%3A%201%7D%2C%0A%09%09DB%3A%20%20%20%20%20%20%20%20%20%20%20%20%20%22new_adn%22%2C%0A%09%09Collection%3A%20%20%20%20%20%22campaign%22%2C%0A%09%09ConnectTimeout%3A%2010000%2C%0A%09%09ReadTimeout%3A%20%20%20%2020000%2C%0A%09%09UserData%3A%20%20%20%20%20%20%20%26UserData%7B%7D%2C%0A%09%09Logger%3A%20%20%20%20%20%20%20%20%20logrus.New()%2C%0A%09%09OnBeforeInc%3A%20func(userData%20interface%7B%7D)%20interface%7B%7D%20%7B%0A%09%09%09ud%2C%20ok%20%3A%3D%20userData.(*UserData)%0A%09%09%09if%20!ok%20%7B%0A%09%09%09%09return%20nil%0A%09%09%09%7D%0A%09%09%09incQuery%20%3A%3D%20bson.M%7B%22updated%22%3A%20bson.M%7B%22%24gte%22%3A%20ud.upTime%20-%205%2C%20%22%24lte%22%3A%20time.Now().Unix()%7D%7D%0A%09%09%09return%20incQuery%0A%09%09%7D%2C%0A%09%7D)%0A%09if%20e%20!%3D%20nil%20%7B%0A%09%09fmt.Println(e)%0A%09%09return%0A%09%7D%0A%09if%20e%20%3A%3D%20b.Build(ctx%2C%20%22indexName%22)%3B%20e%20!%3D%20nil%20%7B%0A%09%09fmt.Println(%22build%20error%22%2C%20e.Error())%0A%09%7D%0A%20%20%20%20%2F%2F%20index%0A%09tIndex%20%3A%3D%20b.GetIndex()%0A%09%2F%2F%20invert%20list%0A%09invertIdx%20%3A%3D%20tIndex.GetInvertedIndex()%0A%09%2F%2F%20storage%0A%09storageIdx%20%3A%3D%20tIndex.GetStorageIndex()%0A%60%60%60%0A%20%0A%20%20%20%20%0A%0A%20</center></body></html>